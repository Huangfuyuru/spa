var $menubar=function(){var o,d=$('<div class="notepad-menubar"></div>'),c=[],r=-1;function e(){!function(){for(var t=$('<ul class="menu-title"></ul>'),e=0;e<o.length;e++){var l=$('<li class="title"></li>');l.html(o[e].title),l.attr("data-id",e),t.append(l),l.click(function(t){var e=Number(this.dataset.id);r=-1===r?(c[e].css({display:"inline-block"}),e):r!==e?(c[r].css({display:"none"}),c[e].css({display:"inline-block"}),e):(c[r].css({display:"none"}),-1),t.stopPropagation()}),l.hover(function(){if(-1!==r){var t=Number(this.dataset.id);c[r].css({display:"none"}),c[t].css({display:"inline-block"}),r=t}})}d.append(t)}(),function(){for(var t=0;t<o.length;t++){for(var e=$('<ul class="menus"></ul>'),l=o[t].menuItems,n=0;n<l.length;n++)if("hr"!==l[n].title){var s=$('<li class="menu-item"></li>');if(s.html(l[n].title),s.attr("data-x",t),s.attr("data-y",n),""!==l[n].shortcut){var i=$('<span class="shortcut"></span>');i.html(l[n].shortcut),s.append(i)}l[n].enabled||s.addClass("disabled"),e.append(s),s.click(function(t){if(t.stopPropagation(),!$(this).hasClass("disabled")){var e=this.dataset.x,l=this.dataset.y;c[e].css({display:"none"}),r=-1,o[e].menuItems[l].handler()}})}else{var a=$('<li class="menu-hr"></li>');e.append(a)}e.css({width:o[t].width,left:o[t].left,display:"none"}),d.append(e),c.push(e)}}(),$("body").append(d)}return{show:function(t){o=t,e()},checked:function(t,e,l){var n=c[t].find(".menu-item")[e];l?$(n).prepend($('<span class="checked">✓</span>')[0]):$(n).find(".checked").remove()},enabled:function(t,e,l){var n=c[t].find(".menu-item")[e];l?$(n).removeClass("disabled"):$(n).addClass("disabled")},hideMenu:function(){-1!==r&&(c[r].css({display:"none"}),r=-1)}}}(),$editor=function(){var e=$('<div class="notepad-editor"><textarea spellcheck="false" auto-size="none"></textarea></div>'),i=e.find("textarea"),a={posHandler:null,contentHandler:null,wrap:!1},t=!1;function o(){var t=i.val().substr(0,i[0].selectionStart).split("\n");return t[t.length-1].length+1}function d(){return i.val().substr(0,i[0].selectionStart).split("\n").length}function l(t){t?(i.attr("wrap","soft"),i.css({"overflow-x":"hidden"})):(i.attr("wrap","off"),i.css({"overflow-x":"scroll"}))}return i.keyup(function(){a.posHandler(d(),o()),a.contentHandler(""!==i.val())}),i.keypress(function(){a.posHandler(d(),o())}),i.mousedown(function(){t=!0}),i.mouseup(function(){t=!1}),i.mousemove(function(){t&&a.posHandler(d(),o())}),i.click(function(){a.posHandler(d(),o())}),{show:function(t){$.extend(a,t),$("body").append(e),i.trigger("focus"),l(a.wrap)},resize:function(t){t?e.css({bottom:"21px"}):e.css({bottom:"0"})},focus:function(){i.focus()},getTotalLn:function(){return i.val().split("\n").length},getRow:d,getCol:o,setWrap:l,selectAll:function(){var t=i.val().length;i[0].selectionStart=0,i[0].selectionEnd=t,i.select()},insertDataTime:function(){var t=i.val(),e=t.substring(0,i[0].selectionStart),l=t.substring(i[0].selectionEnd,t.length);t=e+(new Date).toLocaleString()+l,i.val(t),i.focus(),a.posHandler(d(),o())},gotoLn:function(t){for(var e=0,l=i.val().split("\n"),n=0;n<t-1;n++)e+=l[n].length+1;i[0].selectionStart=e,i[0].selectionEnd=e,i.focus(),a.posHandler(d(),o())},bingSearch:function(){var t=i[0].selectionStart,e=i[0].selectionEnd;if(t===e)window.open("https://cn.bing.com/","_blank");else{var l=i.val().substring(t,e);window.open("https://cn.bing.com/search?q="+l,"_blank")}},search:function(t){var e=i.val(),l=t.content;t.capitalSense||(e=e.toLowerCase(),l=l.toLowerCase());var n,s=i[0].selectionEnd;n="down"===t.direction?e.indexOf(l,s):e.substr(0,i[0].selectionStart).lastIndexOf(l),-1!==n?(i[0].selectionStart=n,i[0].selectionEnd=n+l.length,a.posHandler(d(),o())):alert('找不到 "'+t.content+'"')},setFont:function(t){i.css({"font-family":t.family,"font-size":t.size+"pt"}),"斜体"!==t.style?"粗体"!==t.style?"粗偏斜体"!==t.style||i.css({"font-weight":"bold","font-style":"italic"}):i.css({"font-weight":"bold"}):i.css({"font-style":"italic"})}}}(),$statusBar=function(){var e=$('<div class="notepad-statusbar"><div class="left-panel"></div><div class="right-panel"><p class="row-col"></p></div></div>'),l=e.find(".row-col"),n="第&nbsp;x&nbsp;行，第&nbsp;y&nbsp;列",s={row:1,col:1};function i(t,e){l.html(n.replace("x",t).replace("y",e))}return{init:function(t){$.extend(s,t),i(s.row,s.col),$("body").append(e)},setRowCol:i,display:function(t){t?e.css("display","block"):e.css("display","none")}}}(),$dlgFont=function(){var e=$('<div class="notepad-dlg-mask notepad-dlg-font"><div class="dialogbox notepad-dlgbox"><div class="notepad-dlg-titlebar"><p class="title">字体</p><span class="close-btn" title="关闭">✖</span></div><div class="main notepad-dlg-main"><div class="font-family"><p>字体(F):</p></div><div class="font-style"><p>字形(Y):</p></div><div class="font-size"><p>大小(S):</p></div><fieldset class="sample"><legend>示例</legend><p class="sample-txt">AaBbYyZz</p></fieldset><div class="script"><label>脚本(R):<br><select><option value="西欧语言">西欧语言</option><option value="中文 GB2312">中文 GB2312</option></select></label></div><input class="btn-ok btn" type="button" value="确定"><input class="btn-cancel btn" type="button" value="取消"></div></div></div>'),l=e.find(".btn-ok"),n=e.find(".close-btn"),s=e.find(".btn-cancel"),t=e.find(".sample-txt"),i=e.find(".notepad-dlg-titlebar"),a=["Agency FB","Algerian","Arial","Arial Rounded MT","Axure Handwriting","Bahnschrift","Baskerville Old Face","Bauhaus 93","Bell MT","Berlin Sans FB","Bernard MT","BlackAdder ITC"],o=["常规","斜体","粗体","粗偏斜体"],d=["8","9","10","11","12","14","16","18","20","22","24","26","28","36","48","72"],c={family:"Arial",style:"常规",size:"16",okHandler:null};function r(){t.css({"font-family":c.family,"font-size":c.size+"pt"}),"斜体"!==c.style?"粗体"!==c.style?"粗偏斜体"!==c.style||t.css({"font-weight":"bold","font-style":"italic"}):t.css({"font-weight":"bold"}):t.css({"font-family":"italic"})}function u(){e.remove()}return{show:function(t){$.extend(c,t),$("body").append(e),(new comList).show({container:".notepad-dlg-font .font-family",width:"176px",list:a,select:a.indexOf(c.family),isFont:!0,selectHandler:function(t){c.family=a[t],r()}}),(new comList).show({container:".notepad-dlg-font .font-style",width:"132px",list:o,select:o.indexOf(c.style),isFontStyle:!0,selectHandler:function(t){c.style=o[t],r()}}),(new comList).show({container:".notepad-dlg-font .font-size",width:"64px",list:d,select:d.indexOf(c.size),selectHandler:function(t){c.size=d[t],r()}}),r(),e.find(".dialogbox").draggable({handle:i}),n.click(u),s.click(u),l.click(function(){c.okHandler({family:c.family,style:c.style,size:c.size}),u()}),e.click(function(t){t.stopPropagation()})}}}();function comList(){var s,l=$('<div class="notepad-com-list"><input class="editor" type="text"><br><ul class="list"></ul></div>'),n=l.find(".editor"),i=l.find(".list"),a={container:"",list:[],select:0,width:"200px",isFont:!1,isFontStyle:!1,selectHandler:null};function e(){var t,e=$(a.container).find(".notepad-com-list");0!==e.length&&e.remove(),$(a.container).append(l),l.css({width:a.width}),function(){var t,e,l,n=0;if(a.isFont)for(n=0;n<a.list.length;n++)(t=$('<li class="item"></li>')).css({"font-family":a.list[n]}),i.append(t.html(a.list[n]));else if(a.isFontStyle)for(n=0;n<a.list.length;n++)t=$('<li class="item"></li>'),e=t,"斜体"!==(l=a.list[n])?"粗体"!==l?"粗偏斜体"!==l||e.css({"font-weight":"bold","font-style":"italic"}):e.css({"font-weight":"bold"}):e.css({"font-style":"italic"}),t.html(a.list[n]),i.append(t);else for(n=0;n<a.list.length;n++)(t=$('<li class="item"></li>')).html(a.list[n]),i.append(t);s=i.find(".item")}(),t=a.select,$(s[t]).addClass("selected"),n.val(a.list[t]),n.select()}this.show=function(t){$.extend(a,t),e(),i.click(function(t){$(s[a.select]).removeClass("selected"),a.select=a.list.indexOf($(t.target).html()),$(s[a.select]).addClass("selected"),n.val(a.list[a.select]),a.selectHandler(a.select)}),n.keyup(function(){var t=0;for(t=0;t<a.list.length&&0!==a.list[t].indexOf(n.val());t++);t!==a.list.length&&(s[t].scrollIntoView({behavior:"smooth",block:"start"}),$(s[a.select]).removeClass("selected"),$(s[t]).addClass("selected"),a.select=t)})}}var np={config:{appContainer:".notepad-app"},bShowStatusBar:!1,bWrap:!1,fontFamily:"Arial",fontStyle:"常规",fontSize:"16",fontHandler:function(t){np.fontFamily=t.family,np.fontStype=t.style,np.fontSize=t.size,$editor.setFont(t)}};$(function(){$menubar.show(np.menuData),$editor.show({posHandler:function(t,e){$statusBar.setRowCol(t,e)},contentHandler:function(t){$menubar.enabled(1,6,t)}}),$editor.setFont({family:np.fontFamily,style:np.fontStype,size:np.fontSize}),$statusBar.init(),$statusBar.display(!1),$("body").click(function(){$menubar.hideMenu(),$editor.focus()})}),np.menuData=[{title:"文件(F)",menuItems:[{title:"新建(N)",shortcut:"Ctrl+N",enabled:!0,handler:null},{title:"打开(O)...",shortcut:"Ctrl+O",enabled:!0,handler:null},{title:"保存(S)",shortcut:"Ctrl+S",enabled:!0,handler:null},{title:"另存为(A)...",shortcut:"",enabled:!0,handler:null},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"页面设置(U)...",shortcut:"",enabled:!0,handler:null},{title:"打印(P)...",shortcut:"Ctrl+P",enabled:!0,handler:null},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"退出(X)",shortcut:"",enabled:!0,handler:null}],width:"202px",left:"0px"},{title:"编辑(E)",menuItems:[{title:"撤销(U)",shortcut:"Ctrl+Z",enabled:!1,handler:null},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"剪切(T)",shortcut:"Ctrl+X",enabled:!0,handler:null},{title:"复制(C)",shortcut:"Ctrl+C",enabled:!1,handler:null},{title:"粘贴(P)",shortcut:"Ctrl+V",enabled:!1,handler:null},{title:"删除(L)",shortcut:"Del",enabled:!1,handler:null},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"使用 Bing 搜索...",shortcut:"Ctrl+E",enabled:!0,handler:null},{title:"查找(F)...",shortcut:"Ctrl+F",enabled:!1,handler:null},{title:"查找下一个(N)",shortcut:"F3",enabled:!1,handler:null},{title:"替换(R)...",shortcut:"Ctrl+H",enabled:!0,handler:null},{title:"转到(G)...",shortcut:"Ctrl+G",enabled:!0,handler:null},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"全选(A)",shortcut:"Ctrl+A",enabled:!0,handler:null},{title:"时间/日期(D)",shortcut:"F5",enabled:!0,handler:null}],width:"218px",left:"52px"},{title:"格式(O)",menuItems:[{title:"自动换行(W)",shortcut:"",enabled:!0,handler:null},{title:"字体(F)...",shortcut:"",enabled:!0,handler:function(){$dlgFont.show({family:np.fontFamily,style:np.fontStyle,size:np.fontSize,okHandler:np.fontHandler})}}],width:"156px",left:"106px"},{title:"查看(V)",menuItems:[{title:"状态栏(S)",shortcut:"",enabled:!0,handler:null}],width:"138px",left:"162px"},{title:"帮助(H)",menuItems:[{title:"查看帮助(H)",shortcut:"",enabled:!0,handler:null},{title:"关于记事本(A)",shortcut:"",enabled:!0,handler:null}],width:"166px",left:"216px"}];